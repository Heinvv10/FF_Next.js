{
  "project": "FibreFlow Ticketing Module",
  "version": "1.0.0",
  "created": "2025-12-18",
  "description": "Comprehensive ticketing system with 7 ticket sources, billing automation, WhatsApp bridge, QContact integration, and SLA management",
  "total_features": 45,
  "total_tests": 247,
  "validation_checklist": {
    "nlnh_confidence": 0.8,
    "dgts_threshold": 0.3,
    "quality_gates": [
      "NO_CONSOLE_LOG",
      "PROPER_ERROR_HANDLING",
      "TYPE_SAFETY",
      "DATABASE_ENDPOINT_VALIDATION",
      "APIRESPONSE_PATTERN",
      "FLATTENED_ROUTES",
      "ANTIHALL_VALIDATION",
      "ZERO_TYPESCRIPT_ERRORS",
      "ZERO_ESLINT_ERRORS",
      "TEST_COVERAGE_95_PERCENT",
      "PLAYWRIGHT_E2E_PASS",
      "NO_MOCK_DATA",
      "VITEST_PASS",
      "BUILD_SUCCESS",
      "DEPLOY_DEV_FIRST",
      "EXPERTISE_SELF_IMPROVE"
    ]
  },
  "features": [
    {
      "id": "F001",
      "phase": 1,
      "category": "Database Schema",
      "name": "Create tickets table with UID generation trigger",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T001-001",
          "type": "integration",
          "name": "Verify tickets table creation",
          "assertions": [
            "Table 'tickets' exists in database",
            "All columns match schema (ticket_uid, source, title, description, etc.)",
            "Primary key is 'id' (UUID)",
            "Unique constraint on 'ticket_uid'",
            "Foreign keys for assigned_to, created_by are valid"
          ]
        },
        {
          "id": "T001-002",
          "type": "integration",
          "name": "Verify UID generation trigger creates TKT-YYYY-NNNNN format",
          "assertions": [
            "INSERT without ticket_uid generates UID automatically",
            "UID format matches TKT-2025-00001 pattern",
            "Sequential numbering works (00001, 00002, 00003)",
            "Year updates when crossing calendar year boundary",
            "Trigger resets counter on new year"
          ]
        },
        {
          "id": "T001-003",
          "type": "integration",
          "name": "Verify billing_type defaults and constraints",
          "assertions": [
            "billing_type is nullable (set after calculation)",
            "Valid enum values: 'guarantee', 'sla', 'billable'",
            "Invalid billing_type rejected with constraint error"
          ]
        }
      ]
    },
    {
      "id": "F002",
      "phase": 1,
      "category": "Database Schema",
      "name": "Create ticket_notes table for internal/external notes",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T002-001",
          "type": "integration",
          "name": "Verify ticket_notes table structure",
          "assertions": [
            "Table 'ticket_notes' exists",
            "Foreign key 'ticket_id' references tickets(id)",
            "Column 'is_internal' (BOOLEAN) exists",
            "Column 'created_by' (UUID) exists",
            "Timestamps (created_at, updated_at) exist"
          ]
        },
        {
          "id": "T002-002",
          "type": "integration",
          "name": "Verify cascade delete on ticket deletion",
          "assertions": [
            "Delete ticket deletes all associated notes",
            "No orphaned notes remain after ticket deletion"
          ]
        }
      ]
    },
    {
      "id": "F003",
      "phase": 1,
      "category": "Database Schema",
      "name": "Create sla_configs table for SLA rules by type and priority",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T003-001",
          "type": "integration",
          "name": "Verify sla_configs table and seeded data",
          "assertions": [
            "Table 'sla_configs' exists",
            "Columns: type (TEXT), priority (TEXT), base_hours (INT)",
            "Seed data loaded for all type/priority combinations",
            "High priority has shortest base_hours",
            "business_hours_only flag exists and defaults to TRUE"
          ]
        }
      ]
    },
    {
      "id": "F004",
      "phase": 1,
      "category": "Database Schema",
      "name": "Create client_contracts table for SLA contract management",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T004-001",
          "type": "integration",
          "name": "Verify client_contracts table structure",
          "assertions": [
            "Table 'client_contracts' exists",
            "Columns: client_id, contract_name, start_date, end_date, sla_custom_hours",
            "Date constraints: end_date >= start_date",
            "UNIQUE constraint on (client_id, contract_name)"
          ]
        },
        {
          "id": "T004-002",
          "type": "integration",
          "name": "Verify active contract detection",
          "assertions": [
            "Query returns contracts where current_date BETWEEN start_date AND end_date",
            "Expired contracts not returned",
            "Future contracts not returned"
          ]
        }
      ]
    },
    {
      "id": "F005",
      "phase": 1,
      "category": "Database Schema",
      "name": "Create project_guarantees table for guarantee period configuration",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T005-001",
          "type": "integration",
          "name": "Verify project_guarantees table",
          "assertions": [
            "Table 'project_guarantees' exists",
            "Columns: project_id, guarantee_period_days",
            "Foreign key to projects table",
            "Default guarantee_period_days is 90"
          ]
        }
      ]
    },
    {
      "id": "F006",
      "phase": 1,
      "category": "Database Schema",
      "name": "Create billable_fee_schedule table for fee lookup",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T006-001",
          "type": "integration",
          "name": "Verify billable_fee_schedule table and seed data",
          "assertions": [
            "Table 'billable_fee_schedule' exists",
            "Columns: ticket_type, base_fee, hourly_rate, travel_fee",
            "Seed data includes: 'Installation', 'Repair', 'Consultation', 'Emergency'",
            "All fees are positive DECIMAL values"
          ]
        }
      ]
    },
    {
      "id": "F007",
      "phase": 1,
      "category": "Database Schema",
      "name": "Create remaining 6 tables (attachments, history, tags, billing, assignment_history, notification_log)",
      "priority": "MAJOR",
      "tests": [
        {
          "id": "T007-001",
          "type": "integration",
          "name": "Verify all 12 tables exist",
          "assertions": [
            "Query information_schema.tables confirms all 12 tables",
            "ticket_attachments table exists",
            "ticket_history table exists",
            "ticket_tags table exists",
            "ticket_billing table exists",
            "ticket_assignment_history table exists",
            "notification_log table exists"
          ]
        }
      ]
    },
    {
      "id": "F008",
      "phase": 1,
      "category": "TypeScript Types",
      "name": "Define core ticket types in src/modules/ticketing/types/tickets.ts",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T008-001",
          "type": "unit",
          "name": "Verify Ticket interface definition",
          "assertions": [
            "Type 'Ticket' exported from types/tickets.ts",
            "All fields typed correctly (ticket_uid: string, source: TicketSource enum, etc.)",
            "Optional fields marked with ?",
            "JSDoc comments on all properties"
          ]
        },
        {
          "id": "T008-002",
          "type": "unit",
          "name": "Verify TicketSource enum matches PRD",
          "assertions": [
            "Enum TicketSource includes: 'qcontact', 'whatsapp_inbound', 'email', 'construction', 'internal', 'whatsapp_outbound', 'ad_hoc'",
            "Total of 7 sources"
          ]
        },
        {
          "id": "T008-003",
          "type": "unit",
          "name": "Verify BillingType enum",
          "assertions": [
            "Enum BillingType includes: 'guarantee', 'sla', 'billable'",
            "Total of 3 billing types"
          ]
        }
      ]
    },
    {
      "id": "F009",
      "phase": 1,
      "category": "TypeScript Types",
      "name": "Define billing types in src/modules/ticketing/types/billing.ts",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T009-001",
          "type": "unit",
          "name": "Verify BillingCalculationResult interface",
          "assertions": [
            "Interface exported with properties: billing_type, estimated_cost, requires_approval",
            "estimated_cost is optional (only for billable)",
            "requires_approval is boolean"
          ]
        }
      ]
    },
    {
      "id": "F010",
      "phase": 1,
      "category": "TypeScript Types",
      "name": "Define SLA types in src/modules/ticketing/types/sla.ts",
      "priority": "MAJOR",
      "tests": [
        {
          "id": "T010-001",
          "type": "unit",
          "name": "Verify SLAConfig interface",
          "assertions": [
            "Interface includes: type, priority, base_hours, business_hours_only",
            "All properties typed correctly"
          ]
        }
      ]
    },
    {
      "id": "F011",
      "phase": 2,
      "category": "API Routes",
      "name": "Create GET /api/ticketing/tickets (list tickets with filters)",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T011-001",
          "type": "integration",
          "name": "Verify GET /api/ticketing/tickets returns all tickets",
          "assertions": [
            "Endpoint responds with 200 OK",
            "Response uses apiResponse.success pattern",
            "Returns array of tickets",
            "Each ticket includes ticket_uid, title, status, etc."
          ]
        },
        {
          "id": "T011-002",
          "type": "integration",
          "name": "Verify status filter works",
          "assertions": [
            "GET /api/ticketing/tickets?status=new returns only new tickets",
            "GET /api/ticketing/tickets?status=in_progress returns only in_progress tickets",
            "Invalid status returns 400 with apiResponse.error"
          ]
        },
        {
          "id": "T011-003",
          "type": "integration",
          "name": "Verify Clerk authentication required",
          "assertions": [
            "Request without auth token returns 401 Unauthorized",
            "Request with invalid token returns 401",
            "Request with valid token succeeds with 200"
          ]
        }
      ]
    },
    {
      "id": "F012",
      "phase": 2,
      "category": "API Routes",
      "name": "Create POST /api/ticketing/tickets (create new ticket)",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T012-001",
          "type": "integration",
          "name": "Verify ticket creation with auto-UID generation",
          "assertions": [
            "POST creates ticket successfully",
            "Response includes ticket_uid in TKT-YYYY-NNNNN format",
            "Database trigger generates UID automatically",
            "Response uses apiResponse.success pattern"
          ]
        },
        {
          "id": "T012-002",
          "type": "integration",
          "name": "Verify billing_type calculation on creation",
          "assertions": [
            "New ticket with DR number calculates billing_type",
            "Ticket within guarantee period gets billing_type='guarantee'",
            "Ticket outside guarantee with active contract gets billing_type='sla'",
            "Ticket without DR or contract gets billing_type='billable'"
          ]
        },
        {
          "id": "T012-003",
          "type": "integration",
          "name": "Verify validation errors",
          "assertions": [
            "Missing required field (title) returns 400 with apiResponse.error",
            "Invalid source enum returns 400",
            "Empty request body returns 400"
          ]
        }
      ]
    },
    {
      "id": "F013",
      "phase": 2,
      "category": "API Routes",
      "name": "Create GET /api/ticketing/tickets-[id] (get single ticket)",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T013-001",
          "type": "integration",
          "name": "Verify single ticket retrieval",
          "assertions": [
            "GET /api/ticketing/tickets-ABC123 returns ticket data",
            "Response uses apiResponse.success",
            "Includes all ticket fields",
            "Includes related data (notes, attachments, history)"
          ]
        },
        {
          "id": "T013-002",
          "type": "integration",
          "name": "Verify 404 for non-existent ticket",
          "assertions": [
            "GET /api/ticketing/tickets-INVALID returns 404",
            "Response uses apiResponse.notFound('Ticket', 'INVALID')"
          ]
        }
      ]
    },
    {
      "id": "F014",
      "phase": 2,
      "category": "API Routes",
      "name": "Create PATCH /api/ticketing/tickets-[id] (update ticket)",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T014-001",
          "type": "integration",
          "name": "Verify ticket update",
          "assertions": [
            "PATCH /api/ticketing/tickets-ABC123 updates ticket",
            "Response includes updated ticket data",
            "Database reflects changes",
            "Updated_at timestamp changes"
          ]
        },
        {
          "id": "T014-002",
          "type": "integration",
          "name": "Verify immutable ticket_uid",
          "assertions": [
            "Attempt to update ticket_uid is ignored or rejected",
            "UID remains unchanged after PATCH"
          ]
        }
      ]
    },
    {
      "id": "F015",
      "phase": 2,
      "category": "API Routes",
      "name": "Create flattened API routes for Vercel compatibility (25 total endpoints)",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T015-001",
          "type": "integration",
          "name": "Verify all 25 API endpoints exist and are flattened",
          "assertions": [
            "No nested dynamic routes (e.g., /api/ticketing/[id]/notes)",
            "All routes flattened: /api/ticketing/tickets-notes, /api/ticketing/tickets-assign, etc.",
            "Query params used for IDs where needed (?ticketId=ABC123)",
            "All endpoints respond with 200 or appropriate status"
          ]
        }
      ]
    },
    {
      "id": "F016",
      "phase": 2,
      "category": "API Routes",
      "name": "Create POST /api/ticketing/tickets-assign (assign ticket to user)",
      "priority": "MAJOR",
      "tests": [
        {
          "id": "T016-001",
          "type": "integration",
          "name": "Verify ticket assignment",
          "assertions": [
            "POST assigns ticket to user_id",
            "Database updates assigned_to field",
            "Assignment history logged in ticket_assignment_history",
            "Notification sent to assignee (if notification service active)"
          ]
        }
      ]
    },
    {
      "id": "F017",
      "phase": 2,
      "category": "API Routes",
      "name": "Create POST /api/ticketing/tickets-status (change ticket status)",
      "priority": "MAJOR",
      "tests": [
        {
          "id": "T017-001",
          "type": "integration",
          "name": "Verify status change workflow",
          "assertions": [
            "POST changes status from 'new' to 'triaged'",
            "Valid status transitions accepted",
            "Invalid transitions rejected with 400",
            "SLA paused when status changes to 'blocked'",
            "SLA resumed when status changes from 'blocked'"
          ]
        }
      ]
    },
    {
      "id": "F018",
      "phase": 2,
      "category": "API Routes",
      "name": "Create webhook endpoints for QContact, WhatsApp, Email",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T018-001",
          "type": "integration",
          "name": "Verify POST /api/ticketing/tickets-webhook-qcontact",
          "assertions": [
            "Webhook accepts QContact payload",
            "Creates ticket with source='qcontact'",
            "Generates UID in FT{number} format",
            "Stores original QContact ticket ID"
          ]
        },
        {
          "id": "T018-002",
          "type": "integration",
          "name": "Verify POST /api/ticketing/tickets-webhook-whatsapp",
          "assertions": [
            "Webhook accepts WAHA payload",
            "Parses incoming WhatsApp message",
            "Creates ticket with source='whatsapp_inbound'",
            "Extracts DR number if present"
          ]
        },
        {
          "id": "T018-003",
          "type": "integration",
          "name": "Verify POST /api/ticketing/tickets-webhook-email",
          "assertions": [
            "Webhook accepts email payload",
            "Creates ticket with source='email'",
            "Parses subject as title",
            "Parses body as description",
            "Extracts attachments if present"
          ]
        }
      ]
    },
    {
      "id": "F019",
      "phase": 2,
      "category": "API Routes",
      "name": "Create billing management endpoints (approve, reject, calculate, invoice)",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T019-001",
          "type": "integration",
          "name": "Verify GET /api/ticketing/billing-pending-approval",
          "assertions": [
            "Returns tickets with requires_billing_approval=TRUE and status='pending_approval'",
            "Includes estimated_cost",
            "Sorted by created_at DESC"
          ]
        },
        {
          "id": "T019-002",
          "type": "integration",
          "name": "Verify POST /api/ticketing/billing-approve-[uid]",
          "assertions": [
            "Approves billable ticket",
            "Sets status='triaged'",
            "Sets requires_billing_approval=FALSE",
            "Logs approval in ticket_history"
          ]
        },
        {
          "id": "T019-003",
          "type": "integration",
          "name": "Verify POST /api/ticketing/billing-reject-[uid]",
          "assertions": [
            "Rejects billable ticket",
            "Sets status='rejected'",
            "Logs rejection reason in ticket_history"
          ]
        },
        {
          "id": "T019-004",
          "type": "integration",
          "name": "Verify GET /api/ticketing/billing-calculate",
          "assertions": [
            "Calculates billing_type for given DR number and ticket data",
            "Returns: { billing_type, estimated_cost, requires_approval }",
            "Logic matches billingCalculator.ts service"
          ]
        }
      ]
    },
    {
      "id": "F020",
      "phase": 3,
      "category": "Service Layer",
      "name": "Implement billingCalculator.ts service for automatic billing classification",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T020-001",
          "type": "unit",
          "name": "Verify guarantee detection logic",
          "assertions": [
            "Ticket with DR number within guarantee period returns billing_type='guarantee'",
            "Queries drops table for install_date",
            "Calculates guarantee_expires_at = install_date + guarantee_period_days",
            "Returns guarantee if current_date < guarantee_expires_at"
          ]
        },
        {
          "id": "T020-002",
          "type": "unit",
          "name": "Verify SLA contract detection",
          "assertions": [
            "Ticket outside guarantee checks client_contracts",
            "Returns billing_type='sla' if active contract exists",
            "Uses contract sla_custom_hours"
          ]
        },
        {
          "id": "T020-003",
          "type": "unit",
          "name": "Verify billable classification",
          "assertions": [
            "Ticket without DR or contract returns billing_type='billable'",
            "Calculates estimated_cost from billable_fee_schedule",
            "Sets requires_billing_approval=TRUE"
          ]
        }
      ]
    },
    {
      "id": "F021",
      "phase": 3,
      "category": "Service Layer",
      "name": "Implement slaCalculator.ts service for SLA due_at calculation",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T021-001",
          "type": "unit",
          "name": "Verify SLA due_at calculation",
          "assertions": [
            "Queries sla_configs for base_hours by type/priority",
            "Calculates due_at = created_at + base_hours",
            "Adjusts for business hours if business_hours_only=TRUE"
          ]
        },
        {
          "id": "T021-002",
          "type": "unit",
          "name": "Verify business hours adjustment",
          "assertions": [
            "Skips weekends when calculating due_at",
            "Skips non-business hours (before 8am, after 6pm)",
            "Correctly adds hours across multiple days"
          ]
        },
        {
          "id": "T021-003",
          "type": "unit",
          "name": "Verify SLA pause/resume",
          "assertions": [
            "When status='blocked', sets sla_paused_at timestamp",
            "When status changes from 'blocked', resumes SLA countdown",
            "Elapsed time excludes paused duration"
          ]
        }
      ]
    },
    {
      "id": "F022",
      "phase": 3,
      "category": "Service Layer",
      "name": "Implement drLookupService.ts for auto-populate from DR number",
      "priority": "MAJOR",
      "tests": [
        {
          "id": "T022-001",
          "type": "unit",
          "name": "Verify DR lookup queries drops table",
          "assertions": [
            "Service accepts DR number (e.g., 'DR1234567')",
            "Queries drops table WHERE dr_number = input",
            "Returns: { install_date, project_id, client_id, address }",
            "Returns null if DR not found"
          ]
        }
      ]
    },
    {
      "id": "F023",
      "phase": 3,
      "category": "Service Layer",
      "name": "Implement ticketService.ts for CRUD operations",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T023-001",
          "type": "unit",
          "name": "Verify createTicket method",
          "assertions": [
            "Accepts ticket data object",
            "Inserts into tickets table",
            "Returns created ticket with generated UID",
            "Calls billingCalculator to set billing_type"
          ]
        },
        {
          "id": "T023-002",
          "type": "unit",
          "name": "Verify getTicket method",
          "assertions": [
            "Accepts ticket_id or ticket_uid",
            "Returns full ticket with relations (notes, attachments)",
            "Returns null if not found"
          ]
        }
      ]
    },
    {
      "id": "F024",
      "phase": 3,
      "category": "Service Layer",
      "name": "Implement notificationService.ts for SLA alerts and escalations",
      "priority": "MAJOR",
      "tests": [
        {
          "id": "T024-001",
          "type": "unit",
          "name": "Verify SLA warning notification at 75% elapsed",
          "assertions": [
            "When (elapsed / total) > 0.75, sends warning notification",
            "Notification targets assigned_to user",
            "Logs notification in notification_log table"
          ]
        },
        {
          "id": "T024-002",
          "type": "unit",
          "name": "Verify SLA escalation at 90% elapsed",
          "assertions": [
            "When (elapsed / total) > 0.90, escalates to management",
            "Sends notification to escalation_user_id",
            "Marks ticket with sla_escalated=TRUE"
          ]
        }
      ]
    },
    {
      "id": "F025",
      "phase": 4,
      "category": "UI Components",
      "name": "Create TicketDashboard.tsx with metrics and filters",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T025-001",
          "type": "e2e",
          "name": "Verify dashboard renders with AppLayout",
          "assertions": [
            "Navigate to /ticketing",
            "Page uses AppLayout component",
            "Sidebar visible",
            "Metrics cards display: Total Tickets, Open, In Progress, Resolved"
          ]
        },
        {
          "id": "T025-002",
          "type": "e2e",
          "name": "Verify dashboard filters work",
          "assertions": [
            "Select status filter 'new'",
            "Ticket list updates to show only new tickets",
            "Select date range filter",
            "Ticket list filters by date",
            "Clear filters button resets to all tickets"
          ]
        }
      ]
    },
    {
      "id": "F026",
      "phase": 4,
      "category": "UI Components",
      "name": "Create TicketList.tsx with table and pagination",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T026-001",
          "type": "e2e",
          "name": "Verify ticket list displays tickets",
          "assertions": [
            "Table shows columns: UID, Title, Status, Priority, Created, Assigned To",
            "Each row is clickable",
            "Click row navigates to /ticketing/[uid]",
            "Pagination controls present if > 50 tickets"
          ]
        }
      ]
    },
    {
      "id": "F027",
      "phase": 4,
      "category": "UI Components",
      "name": "Create TicketForm.tsx for create/edit with DR lookup",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T027-001",
          "type": "e2e",
          "name": "Verify ticket creation form",
          "assertions": [
            "Click 'New Ticket' button",
            "Form modal opens",
            "Fields: Title, Description, Source, DR Number (optional)",
            "Submit creates ticket",
            "Success toast displays",
            "List refreshes with new ticket"
          ]
        },
        {
          "id": "T027-002",
          "type": "e2e",
          "name": "Verify DR number auto-populate",
          "assertions": [
            "Enter DR number in form",
            "Click 'Lookup' button",
            "Form auto-fills: Project, Client, Address (from drLookupService)",
            "Billing type indicator updates"
          ]
        }
      ]
    },
    {
      "id": "F028",
      "phase": 4,
      "category": "UI Components",
      "name": "Create TicketDetail.tsx for full ticket view with timeline",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T028-001",
          "type": "e2e",
          "name": "Verify ticket detail view",
          "assertions": [
            "Navigate to /ticketing/TKT-2025-00001",
            "Page displays ticket title, description, status",
            "Timeline shows history (created, assigned, status changes)",
            "Notes section displays internal and external notes",
            "Attachments section shows uploaded files"
          ]
        }
      ]
    },
    {
      "id": "F029",
      "phase": 4,
      "category": "UI Components",
      "name": "Create BillingApprovalQueue.tsx for manager approval UI",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T029-001",
          "type": "e2e",
          "name": "Verify billing approval queue",
          "assertions": [
            "Navigate to /ticketing/billing/approvals",
            "Page shows pending billable tickets",
            "Each ticket shows estimated_cost",
            "Approve button approves ticket",
            "Reject button opens rejection reason modal"
          ]
        }
      ]
    },
    {
      "id": "F030",
      "phase": 4,
      "category": "UI Components",
      "name": "Create SLAIndicator.tsx countdown timer component",
      "priority": "MAJOR",
      "tests": [
        {
          "id": "T030-001",
          "type": "unit",
          "name": "Verify SLA countdown timer",
          "assertions": [
            "Component accepts ticket with due_at timestamp",
            "Calculates remaining time (due_at - now)",
            "Updates every minute",
            "Shows red when SLA breached (remaining < 0)",
            "Shows yellow when SLA > 75% elapsed",
            "Shows green when SLA < 75% elapsed"
          ]
        }
      ]
    },
    {
      "id": "F031",
      "phase": 4,
      "category": "UI Components",
      "name": "Create remaining 11 UI components (badges, cards, forms, managers)",
      "priority": "MAJOR",
      "tests": [
        {
          "id": "T031-001",
          "type": "unit",
          "name": "Verify all 17 components exist and are typed",
          "assertions": [
            "All components in src/modules/ticketing/components/",
            "Each component exports React.FC with typed props",
            "No TypeScript errors",
            "Components use Tailwind CSS and shadcn/ui",
            "Mobile responsive (tested with Playwright browser_resize)"
          ]
        }
      ]
    },
    {
      "id": "F032",
      "phase": 5,
      "category": "Integrations",
      "name": "Implement QContact API client (REST v2 READ + UPDATE)",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T032-001",
          "type": "integration",
          "name": "Verify QContactClient can read tickets",
          "assertions": [
            "Client calls QContact REST API v2",
            "getTickets() returns array of QContact tickets",
            "Authentication header includes API key",
            "Response parsed correctly"
          ]
        },
        {
          "id": "T032-002",
          "type": "integration",
          "name": "Verify QContactClient can update ticket status",
          "assertions": [
            "updateTicketStatus(ticketId, status) calls QContact API",
            "Status updated successfully in QContact",
            "Error handled if API fails"
          ]
        }
      ]
    },
    {
      "id": "F033",
      "phase": 5,
      "category": "Integrations",
      "name": "Implement WhatsApp WAHA client for bidirectional messaging",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T033-001",
          "type": "integration",
          "name": "Verify WAHAClient can send messages",
          "assertions": [
            "sendMessage(chatId, text) sends WhatsApp message via WAHA API",
            "Message delivered successfully",
            "Error handled if WAHA unavailable"
          ]
        },
        {
          "id": "T033-002",
          "type": "integration",
          "name": "Verify WAHAClient can receive messages (webhook)",
          "assertions": [
            "Webhook parses incoming WAHA message payload",
            "Extracts chatId, message text, sender",
            "Creates ticket from message if new conversation"
          ]
        }
      ]
    },
    {
      "id": "F034",
      "phase": 5,
      "category": "Integrations",
      "name": "Implement email parsing for tickets@fibreflow.app",
      "priority": "MAJOR",
      "tests": [
        {
          "id": "T034-001",
          "type": "integration",
          "name": "Verify email parser creates tickets from emails",
          "assertions": [
            "Webhook receives email payload",
            "Parses subject as ticket title",
            "Parses body as description",
            "Extracts attachments",
            "Creates ticket with source='email'"
          ]
        }
      ]
    },
    {
      "id": "F035",
      "phase": 5,
      "category": "Integrations",
      "name": "Implement invoicing API client for line item generation",
      "priority": "MAJOR",
      "tests": [
        {
          "id": "T035-001",
          "type": "integration",
          "name": "Verify invoice line item creation",
          "assertions": [
            "InvoicingClient.createLineItem(data) calls external API",
            "Line item includes: ticket_uid, description, amount, client_id",
            "Response includes invoice_id",
            "Error handled if API fails"
          ]
        }
      ]
    },
    {
      "id": "F036",
      "phase": 6,
      "category": "Testing",
      "name": "Write unit tests for billingCalculator.ts with Vitest",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T036-001",
          "type": "unit",
          "name": "Verify unit test coverage for billingCalculator",
          "assertions": [
            "Test file exists: tests/modules/ticketing/unit/billingCalculator.test.ts",
            "All functions tested: calculateBillingType, estimateCost",
            "Edge cases tested: no DR, expired guarantee, active contract",
            "Coverage > 95%"
          ]
        }
      ]
    },
    {
      "id": "F037",
      "phase": 6,
      "category": "Testing",
      "name": "Write unit tests for slaCalculator.ts with Vitest",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T037-001",
          "type": "unit",
          "name": "Verify unit test coverage for slaCalculator",
          "assertions": [
            "Test file exists: tests/modules/ticketing/unit/slaCalculator.test.ts",
            "All functions tested: calculateDueAt, adjustForBusinessHours, pauseSLA, resumeSLA",
            "Edge cases tested: weekend SLA, overnight SLA, pause/resume",
            "Coverage > 95%"
          ]
        }
      ]
    },
    {
      "id": "F038",
      "phase": 6,
      "category": "Testing",
      "name": "Write integration tests for API routes with Vitest",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T038-001",
          "type": "integration",
          "name": "Verify API route tests",
          "assertions": [
            "Test file exists: tests/modules/ticketing/integration/api-tickets.test.ts",
            "Tests for GET, POST, PATCH, DELETE /api/ticketing/tickets",
            "Tests for webhook endpoints",
            "Tests for billing endpoints",
            "All tests use real database (no mocks)",
            "All tests pass"
          ]
        }
      ]
    },
    {
      "id": "F039",
      "phase": 6,
      "category": "Testing",
      "name": "Write E2E tests for ticket creation flow with Playwright MCP",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T039-001",
          "type": "e2e",
          "name": "Verify E2E test for ticket creation",
          "assertions": [
            "Test file exists: tests/modules/ticketing/e2e/ticket-creation.spec.ts",
            "Test navigates to /ticketing",
            "Test clicks 'New Ticket'",
            "Test fills form and submits",
            "Test verifies ticket appears in list",
            "Test uses mcp__playwright__* tools",
            "Test passes"
          ]
        }
      ]
    },
    {
      "id": "F040",
      "phase": 6,
      "category": "Testing",
      "name": "Write E2E tests for billing approval workflow with Playwright MCP",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T040-001",
          "type": "e2e",
          "name": "Verify E2E test for billing approval",
          "assertions": [
            "Test file exists: tests/modules/ticketing/e2e/billing-approval.spec.ts",
            "Test creates billable ticket",
            "Test navigates to /ticketing/billing/approvals",
            "Test clicks 'Approve' button",
            "Test verifies ticket status changes to 'triaged'",
            "Test passes"
          ]
        }
      ]
    },
    {
      "id": "F041",
      "phase": 6,
      "category": "Testing",
      "name": "Write E2E tests for WhatsApp bridge integration with Playwright MCP",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T041-001",
          "type": "e2e",
          "name": "Verify E2E test for WhatsApp ticket creation",
          "assertions": [
            "Test file exists: tests/modules/ticketing/e2e/whatsapp-bridge.spec.ts",
            "Test simulates incoming WhatsApp message via webhook",
            "Test verifies ticket created with source='whatsapp_inbound'",
            "Test verifies ticket appears in dashboard",
            "Test passes"
          ]
        }
      ]
    },
    {
      "id": "F042",
      "phase": 6,
      "category": "Validation",
      "name": "Run NLNH validator (≥80% confidence)",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T042-001",
          "type": "validation",
          "name": "Verify NLNH confidence score",
          "assertions": [
            "Run PAI NLNH validator on all ticketing module code",
            "Confidence score ≥ 0.80",
            "No hallucinated code references",
            "All imports exist",
            "All function calls exist"
          ]
        }
      ]
    },
    {
      "id": "F043",
      "phase": 6,
      "category": "Validation",
      "name": "Run DGTS validator (≤30% gaming score)",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T043-001",
          "type": "validation",
          "name": "Verify DGTS gaming score",
          "assertions": [
            "Run PAI DGTS validator on all ticketing module code",
            "Gaming score ≤ 0.30",
            "No shortcut implementations",
            "All business logic properly implemented",
            "No placeholder code"
          ]
        }
      ]
    },
    {
      "id": "F044",
      "phase": 6,
      "category": "Validation",
      "name": "Run Zero Tolerance quality gates",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T044-001",
          "type": "validation",
          "name": "Verify zero TypeScript errors",
          "assertions": [
            "Run npm run type-check",
            "Zero TypeScript errors",
            "All types defined",
            "No 'any' types"
          ]
        },
        {
          "id": "T044-002",
          "type": "validation",
          "name": "Verify zero ESLint errors",
          "assertions": [
            "Run npm run lint",
            "Zero ESLint errors",
            "Zero warnings",
            "Code style consistent"
          ]
        },
        {
          "id": "T044-003",
          "type": "validation",
          "name": "Verify zero console.log statements",
          "assertions": [
            "Grep codebase for console.log",
            "Zero matches in src/modules/ticketing/",
            "Zero matches in pages/api/ticketing/"
          ]
        }
      ]
    },
    {
      "id": "F045",
      "phase": 6,
      "category": "Deployment",
      "name": "Deploy to dev.fibreflow.app and run smoke tests",
      "priority": "CRITICAL",
      "tests": [
        {
          "id": "T045-001",
          "type": "e2e",
          "name": "Verify dev deployment successful",
          "assertions": [
            "SSH to velocity server",
            "Deploy to /var/www/fibreflow-dev",
            "PM2 restart fibreflow-dev",
            "Navigate to https://dev.fibreflow.app/ticketing",
            "Page loads without errors",
            "Create test ticket",
            "Verify ticket appears in database"
          ]
        },
        {
          "id": "T045-002",
          "type": "e2e",
          "name": "Verify production deployment readiness",
          "assertions": [
            "All tests pass on dev environment",
            "User acceptance sign-off received",
            "Ready to deploy to app.fibreflow.app (production)"
          ]
        }
      ]
    }
  ]
}
